<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=hugo-theme content="Axiom 0.8.0">
<link rel=icon type=image/png sizes=32x32 href=/openlumi.github.io/>
<link rel=icon type=image/x-icon href=/openlumi.github.io/>
<link rel=apple-touch-icon href=/openlumi.github.io/>
<link rel=canonical href=https://dpolyakov.github.io/openlumi.github.io/gain-root-on-dgnwg05lm/>
<link rel=preload as=style href="/openlumi.github.io/bundle.css?v=1631896254" media=all>
<link rel=stylesheet href="/openlumi.github.io/bundle.css?v=1631896254" media=all>
<style>.cdata pre{background-color:#1f2937;color:#e5e7eb}.cdata :not(pre)>code{background-color:#f3f4f6;color:#7c3aed}.chroma .err{background-color:#991b1b;color:#fecaca}.chroma .hl{background-color:#374151}.chroma .ln{color:#9ca3af}.chroma .k,.chroma .kc,.chroma .kd,.chroma .kn,.chroma .kp,.chroma .kr{color:#60a5fa}.chroma .kt{color:#a78bfa}.chroma .na,.chroma .nb{color:#fbbf24}.chroma .nc{color:#f87171}.chroma .no{color:#34d399}.chroma .nd{color:#f87171}.chroma .ne{color:#f87171}.chroma .nf{color:#fbbf24}.chroma .nt{color:#f87171}.chroma .l{color:#a78bfa}.chroma .dl,.chroma .ld,.chroma .s,.chroma .s2,.chroma .sa,.chroma .sb,.chroma .sc,.chroma .sd{color:#34d399}.chroma .se{color:#9ca3af}.chroma .s1,.chroma .sh,.chroma .si,.chroma .sr,.chroma .ss,.chroma .sx{color:#34d399}.chroma .il,.chroma .m,.chroma .mb,.chroma .mf,.chroma .mh,.chroma .mi,.chroma .mo{color:#a78bfa}.chroma .o,.chroma .ow{color:#93c5fd}.chroma .c,.chroma .c1,.chroma .ch,.chroma .cm,.chroma .cp,.chroma .cpf,.chroma .cs,.chroma .p{color:#9ca3af}.chroma .ge{font-style:italic}.chroma .gs{font-weight:700}</style>
<title>Gaining root : OpenWrt on DGNWG05LM and ZHWG11LM gateways</title>
<meta property="og:title" content="Gaining root">
<meta property="og:site_name" content="OpenWrt on DGNWG05LM and ZHWG11LM gateways">
<meta property="og:url" content="https://dpolyakov.github.io/openlumi.github.io/gain-root-on-dgnwg05lm/">
<link rel=image_src href=https://dpolyakov.github.io/openlumi.github.io/>
<meta property="og:image" content="https://dpolyakov.github.io/openlumi.github.io/">
<meta property="og:image:width" content>
<meta property="og:image:height" content>
<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:description" content="Solder 3 contacts GND, RX, TX to UART: Then connect UART 2 USB adapter. To use serial console while booting, you can use minicom/picocom on Linux or PuTTY on Windows. Use baudrate 115200. Stop booting by pressing any key in the uart terminal right after powering the device. If it not stops with prompt =&amp;gt; you should reboot the gateway by plugging it off and then on. Prepare a new password for the root user.">
<meta name=description content="Solder 3 contacts GND, RX, TX to UART: Then connect UART 2 USB adapter. To use serial console while booting, you can use minicom/picocom on Linux or PuTTY on Windows. Use baudrate 115200. Stop booting by pressing any key in the uart terminal right after powering the device. If it not stops with prompt =&amp;gt; you should reboot the gateway by plugging it off and then on. Prepare a new password for the root user.">
<meta property="og:updated_time" content="0001-01-01T00:00:00Z">
<meta property="fb:app_id" content>
<meta name=author content="Unknown">
<meta property="article:author" content="https://dpolyakov.github.io/openlumi.github.io">
<meta property="article:published_time" content="0001-01-01T00:00:00Z">
<meta property="article:modified_time" content="0001-01-01T00:00:00Z">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","headline":"Gaining root","alternativeHeadline":"Gaining root DGNWG05LM and ZHWG11LM gateways","url":"https://dpolyakov.github.io/openlumi.github.io/gain-root-on-dgnwg05lm/","image":"https://dpolyakov.github.io/openlumi.github.io/","mainEntityOfPage":{"@type":"WebPage","@id":"https://dpolyakov.github.io/openlumi.github.io/gain-root-on-dgnwg05lm/"},"description":"Solder 3 contacts GND, RX, TX to UART: Then connect UART 2 USB adapter. To use serial console while booting, you can use minicom/picocom on Linux or PuTTY on Windows. Use baudrate 115200. Stop booting by pressing any key in the uart terminal right after powering the device. If it not stops with prompt =\u0026gt; you should reboot the gateway by plugging it off and then on. Prepare a new password for the root user.","author":{"@type":"Person","name":"Unknown"},"publisher":{"@type":"Organization","name":"OpenWrt on DGNWG05LM and ZHWG11LM gateways","logo":{"@type":"ImageObject","url":"https://dpolyakov.github.io/openlumi.github.io/"}},"datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","articleBody":"\u003cp\u003eSolder 3 contacts GND, RX, TX to UART:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"images/uart_pinout.jpg\" alt=\"UART Pinout\"\u003e\u003c/p\u003e\n\u003cp\u003eThen connect UART 2 USB adapter. To use serial console while booting, you\ncan use minicom/picocom on Linux or PuTTY on Windows. Use baudrate 115200.\nStop booting by pressing any key in the uart terminal right after powering the\ndevice. If it not stops with prompt \u003ccode\u003e=\u0026gt;\u003c/code\u003e you should reboot the gateway by\nplugging it off and then on.\u003c/p\u003e\n\u003cp\u003ePrepare a new password for the root user. It can be blank, but you have to\nconfirm it after setting it in the console.\u003c/p\u003e\n\u003cp\u003eEnter the following line and boot will start:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003esetenv bootargs \u0026quot;${bootargs} single rw init=/bin/bash\u0026quot; \u0026amp;\u0026amp; boot\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAfter booting to linux bash console, enter:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003epasswd\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eEnter the prepared password 2 times. In case of an empty password, you have to\npress enter one more time to confirm it.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eNOW YOUR GATEWAY HAS ROOT\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eTo enable ssh server on the gateway add the following line at the end of\n\u003ccode\u003e/etc/rc.local\u003c/code\u003e before the \u003ccode\u003e/home/root/fac/fac_test\u003c/code\u003e line:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e/etc/init.d/dropbear start \u0026amp;\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow you can reboot and connect to your gateway at \u003ccode\u003e*GATEWAY_IP*\u003c/code\u003e, port 22.\u003c/p\u003e\n\u003cp\u003eIf you receive an error:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eStarting Dropbear SSH server: Pseudo-terminal will not be allocated because stdin is not a terminal.\nssh: connect to host rsa port 22: Connection refused\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIt means that your dropbear is compiled without ssh-server support and\ncan serve only as a client. Replace it with a fully functional ssh-server:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003emv /usr/sbin/dropbearmulti /usr/sbin/dropbearmulti.backup\necho -e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;GET /openlumi/openlumi.github.io/master/files/dropbearmulti HTTP/1.0\\nHost: raw.githubusercontent.com\\n\u0026#34;\u003c/span\u003e | openssl s_client -quiet -connect raw.githubusercontent.com:443 -servername raw.githubusercontent.com 2\u0026gt;/dev/null | sed \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;1,/^\\r$/d\u0026#39;\u003c/span\u003e \u0026gt; /usr/sbin/dropbearmulti\nchmod +x /usr/sbin/dropbearmulti\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"setting-wi-fi-without-mi-home-app\"\u003eSetting Wi-Fi without Mi Home app.\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003eYou can omit this section in case the gateway is already connected\nusing Mi Home application.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eAfter rebooting, the gateway enables the testing console.\nTo exit to normal login mode, type \u003ccode\u003eexit_factory\u003c/code\u003e, then press enter.\u003c/p\u003e\n\u003cp\u003eThen log in to the console with the user \u003ccode\u003eroot\u003c/code\u003e and password you have set.\u003c/p\u003e\n\u003ch3 id=\"how-gateway-enables-wi-fi\"\u003eHow gateway enables Wi-Fi\u003c/h3\u003e\n\u003cp\u003eWhile booting, gateway while executing \u003ccode\u003erc.local\u003c/code\u003e it runs the lines:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e/home/root/set_mac.sh \u0026amp;\n/lumi/app/miio/wifi_start.sh \u0026gt; /dev/null 2\u0026gt;\u0026amp;\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e \u0026amp; \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThose lines check for the file \u003ccode\u003e/lumi/conf/wifi.conf\u003c/code\u003e and if it is absent,\nit starts an open Wi-Fi Access Point.\u003c/p\u003e\n\u003ch3 id=\"creating-wi-fi-config\"\u003eCreating Wi-Fi config\u003c/h3\u003e\n\u003cp\u003eRun the following lines with your own Network name and password.\nKeep \u003ccode\u003ekey_mgmt\u003c/code\u003e as is:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003eecho \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;ssid=\u0026#34;lao_mao\u0026#34;\u0026#39;\u003c/span\u003e \u0026gt; /lumi/conf/wifi.conf\necho \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;psk=\u0026#34;12345678\u0026#34;\u0026#39;\u003c/span\u003e \u0026gt;\u0026gt; /lumi/conf/wifi.conf\necho \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;key_mgmt=WPA\u0026#39;\u003c/span\u003e \u0026gt;\u0026gt; /lumi/conf/wifi.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAlso, you can use \u003ccode\u003evi\u003c/code\u003e editor to set Wi-Fi credentials:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003evi /lumi/conf/wifi.conf\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ePress \u003ccode\u003ei\u003c/code\u003e, then paste\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003essid=\u0026quot;lao_mao\u0026quot;\npsk=\u0026quot;12345678\u0026quot;\nkey_mgmt=WPA\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThen exit with saving: (Press Esc, then type \u003ccode\u003e:qw\u003c/code\u003e and press Enter)\u003c/p\u003e\n\u003cp\u003eTo check the config is correct you can manually run the lines\nfrom \u003ccode\u003e/etc/rc.local\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e/lumi/app/miio/wifi_start.sh \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eYou will see the connection process. Press ctrl+c after you got the info\nif the device is connected or not.\nIf the Wi-Fi credentials are set correctly, \u003ccode\u003eifconfig\u003c/code\u003e will show IP address\nof the gateway.\u003c/p\u003e"}</script>
<link rel=preload as=script href="/openlumi.github.io/bundle.js?v=1631896254">
</head>
<body>
<header id=nav class=header>
<div class="ax-l-i max-w-6xl">
<div class=ax-logo>
<a class=block href=/openlumi.github.io/ title="OpenWrt on DGNWG05LM and ZHWG11LM gateways"><span class="font-semibold text-raven-900">OpenWrt on DGNWG05LM and ZHWG11LM gateways</span></a>
</div>
<div class=ax-user>
<a class="p-2 w-8 h-8 block text-raven-500 hover:text-gray-800 focus:text-gray-800 focus:outline-none" target=_blank rel="noopener nofollow" href="https://www.google.com/search?q=site:https://dpolyakov.github.io/openlumi.github.io/" title=Search><svg class="fill-current" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.67 12.804c0-5.6 4.544-10.134 10.133-10.134s10.134 4.544 10.134 10.134-4.544 10.133-10.134 10.133S2.67 18.393 2.67 12.804zm28.943 16.923-8.868-8.868c4.287-5.3 3.68-13.012-1.378-17.57S8.564-1.066 3.75 3.75s-5.017 12.558-.46 17.618 12.28 5.665 17.57 1.378l8.868 8.868a1.33 1.33.0 002.231-.597c.123-.46-.008-.952-.345-1.29h0z"/></svg>
</a>
</div>
</div>
</header>
<main>
<div class=page-single>
<div class="ax-content ax-l-o">
<div class="ax-l-i max-w-680">
<h1 class="page-title font-content-title font-normal leading-tight tracking-default text-40">Gaining root</h1>
<article class="cdata mt-8">
<p>Solder 3 contacts GND, RX, TX to UART:</p>
<p><img src=images/uart_pinout.jpg alt="UART Pinout"></p>
<p>Then connect UART 2 USB adapter. To use serial console while booting, you
can use minicom/picocom on Linux or PuTTY on Windows. Use baudrate 115200.
Stop booting by pressing any key in the uart terminal right after powering the
device. If it not stops with prompt <code>=></code> you should reboot the gateway by
plugging it off and then on.</p>
<p>Prepare a new password for the root user. It can be blank, but you have to
confirm it after setting it in the console.</p>
<p>Enter the following line and boot will start:</p>
<pre tabindex=0><code>setenv bootargs &quot;${bootargs} single rw init=/bin/bash&quot; &amp;&amp; boot
</code></pre><p>After booting to linux bash console, enter:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>passwd
</code></pre></div><p>Enter the prepared password 2 times. In case of an empty password, you have to
press enter one more time to confirm it.</p>
<p><strong>NOW YOUR GATEWAY HAS ROOT</strong></p>
<p>To enable ssh server on the gateway add the following line at the end of
<code>/etc/rc.local</code> before the <code>/home/root/fac/fac_test</code> line:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/etc/init.d/dropbear start &amp;
</code></pre></div><p>Now you can reboot and connect to your gateway at <code>*GATEWAY_IP*</code>, port 22.</p>
<p>If you receive an error:</p>
<pre tabindex=0><code>Starting Dropbear SSH server: Pseudo-terminal will not be allocated because stdin is not a terminal.
ssh: connect to host rsa port 22: Connection refused
</code></pre><p>It means that your dropbear is compiled without ssh-server support and
can serve only as a client. Replace it with a fully functional ssh-server:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>mv /usr/sbin/dropbearmulti /usr/sbin/dropbearmulti.backup
echo -e <span style=color:#e6db74>&#34;GET /openlumi/openlumi.github.io/master/files/dropbearmulti HTTP/1.0\nHost: raw.githubusercontent.com\n&#34;</span> | openssl s_client -quiet -connect raw.githubusercontent.com:443 -servername raw.githubusercontent.com 2&gt;/dev/null | sed <span style=color:#e6db74>&#39;1,/^\r$/d&#39;</span> &gt; /usr/sbin/dropbearmulti
chmod +x /usr/sbin/dropbearmulti
</code></pre></div><h2 id=setting-wi-fi-without-mi-home-app>Setting Wi-Fi without Mi Home app.</h2>
<p><em>You can omit this section in case the gateway is already connected
using Mi Home application.</em></p>
<p>After rebooting, the gateway enables the testing console.
To exit to normal login mode, type <code>exit_factory</code>, then press enter.</p>
<p>Then log in to the console with the user <code>root</code> and password you have set.</p>
<h3 id=how-gateway-enables-wi-fi>How gateway enables Wi-Fi</h3>
<p>While booting, gateway while executing <code>rc.local</code> it runs the lines:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/home/root/set_mac.sh &amp;
/lumi/app/miio/wifi_start.sh &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span> &amp; 
</code></pre></div><p>Those lines check for the file <code>/lumi/conf/wifi.conf</code> and if it is absent,
it starts an open Wi-Fi Access Point.</p>
<h3 id=creating-wi-fi-config>Creating Wi-Fi config</h3>
<p>Run the following lines with your own Network name and password.
Keep <code>key_mgmt</code> as is:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>echo <span style=color:#e6db74>&#39;ssid=&#34;lao_mao&#34;&#39;</span> &gt; /lumi/conf/wifi.conf
echo <span style=color:#e6db74>&#39;psk=&#34;12345678&#34;&#39;</span> &gt;&gt; /lumi/conf/wifi.conf
echo <span style=color:#e6db74>&#39;key_mgmt=WPA&#39;</span> &gt;&gt; /lumi/conf/wifi.conf
</code></pre></div><p>Also, you can use <code>vi</code> editor to set Wi-Fi credentials:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>vi /lumi/conf/wifi.conf
</code></pre></div><p>Press <code>i</code>, then paste</p>
<pre tabindex=0><code>ssid=&quot;lao_mao&quot;
psk=&quot;12345678&quot;
key_mgmt=WPA
</code></pre><p>Then exit with saving: (Press Esc, then type <code>:qw</code> and press Enter)</p>
<p>To check the config is correct you can manually run the lines
from <code>/etc/rc.local</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>/lumi/app/miio/wifi_start.sh 
</code></pre></div><p>You will see the connection process. Press ctrl+c after you got the info
if the device is connected or not.
If the Wi-Fi credentials are set correctly, <code>ifconfig</code> will show IP address
of the gateway.</p>
</article>
</div>
</div>
</div>
</main>
<footer class=footer>
<div class="ax-l-i max-w-6xl">
<nav class="flex items-center justify-center">
</nav>
<div class="footer-copyright text-sm text-center text-gray-400 mt-4">
&#169; -2021 OpenWrt on DGNWG05LM and ZHWG11LM gateways
</div>
<div class="text-sm sm:text-xs text-center text-gray-400 mt-2">
Powered by <a href="https://www.axiomtheme.com/?utm_source=theme-footer&utm_medium=website&utm_campaign=referral">Axiom</a>
</div>
</div>
</footer>
<script src="/openlumi.github.io/bundle.js?v=1631896254"></script>
</body>
</html>